<template>
  <div class="user-profile-about">
    <div class="user-profile-about__img">
<!--      <img :src="avatar" alt="">-->

      <el-upload class="avatar-uploader mb-25" action="" :show-file-list="false" :on-success="handleAvatarSuccess">
        <img v-if="is_own_profile" :src="userData.avatar" alt="" class="avatar">
        <img v-else :src="avatar" alt="" class="avatar">
        <p v-if="is_own_profile" class="user-profile-about__img--change">
          <svg width="22" height="20" viewBox="0 0 22 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 8C18.7348 8 18.4804 8.10536 18.2929 8.29289C18.1054 8.48043 18 8.73478 18 9V16C18 16.2652 17.8946 16.5196 17.7071 16.7071C17.5196 16.8946 17.2652 17 17 17H3C2.73478 17 2.48043 16.8946 2.29289 16.7071C2.10536 16.5196 2 16.2652 2 16V8C2 7.73478 2.10536 7.48043 2.29289 7.29289C2.48043 7.10536 2.73478 7 3 7H5C5.21807 7.01138 5.43386 6.95107 5.61443 6.82829C5.795 6.7055 5.93042 6.52698 6 6.32L6.54 4.68C6.60709 4.48138 6.7349 4.30887 6.90537 4.18684C7.07584 4.06482 7.28036 3.99946 7.49 4H13C13.2652 4 13.5196 3.89464 13.7071 3.70711C13.8946 3.51957 14 3.26522 14 3C14 2.73478 13.8946 2.48043 13.7071 2.29289C13.5196 2.10536 13.2652 2 13 2H7.44C6.81155 2.00118 6.19933 2.19968 5.68977 2.56751C5.1802 2.93533 4.79901 3.45389 4.6 4.05L4.28 5.05H3C2.20435 5.05 1.44129 5.36607 0.87868 5.92868C0.31607 6.49129 0 7.25435 0 8.05V16.05C0 16.8456 0.31607 17.6087 0.87868 18.1713C1.44129 18.7339 2.20435 19.05 3 19.05H17C17.7956 19.05 18.5587 18.7339 19.1213 18.1713C19.6839 17.6087 20 16.8456 20 16.05V9.05C20.0068 8.91453 19.9859 8.7791 19.9387 8.65194C19.8915 8.52479 19.8189 8.40856 19.7254 8.31034C19.6318 8.21212 19.5193 8.13396 19.3946 8.08061C19.2699 8.02726 19.1356 7.99983 19 8ZM10 7C9.20887 7 8.43552 7.2346 7.77772 7.67412C7.11992 8.11365 6.60723 8.73836 6.30448 9.46927C6.00173 10.2002 5.92252 11.0044 6.07686 11.7804C6.2312 12.5563 6.61216 13.269 7.17157 13.8284C7.73098 14.3878 8.44372 14.7688 9.21964 14.9231C9.99556 15.0775 10.7998 14.9983 11.5307 14.6955C12.2616 14.3928 12.8864 13.8801 13.3259 13.2223C13.7654 12.5645 14 11.7911 14 11C14 9.93913 13.5786 8.92172 12.8284 8.17157C12.0783 7.42143 11.0609 7 10 7ZM10 13C9.60444 13 9.21776 12.8827 8.88886 12.6629C8.55996 12.4432 8.30362 12.1308 8.15224 11.7654C8.00087 11.3999 7.96126 10.9978 8.03843 10.6098C8.1156 10.2219 8.30608 9.86549 8.58579 9.58579C8.86549 9.30608 9.22186 9.1156 9.60982 9.03843C9.99778 8.96126 10.3999 9.00087 10.7654 9.15224C11.1308 9.30362 11.4432 9.55996 11.6629 9.88886C11.8827 10.2178 12 10.6044 12 11C12 11.5304 11.7893 12.0391 11.4142 12.4142C11.0391 12.7893 10.5304 13 10 13ZM21 2H20V1C20 0.734784 19.8946 0.48043 19.7071 0.292893C19.5196 0.105357 19.2652 0 19 0C18.7348 0 18.4804 0.105357 18.2929 0.292893C18.1054 0.48043 18 0.734784 18 1V2H17C16.7348 2 16.4804 2.10536 16.2929 2.29289C16.1054 2.48043 16 2.73478 16 3C16 3.26522 16.1054 3.51957 16.2929 3.70711C16.4804 3.89464 16.7348 4 17 4H18V5C18 5.26522 18.1054 5.51957 18.2929 5.70711C18.4804 5.89464 18.7348 6 19 6C19.2652 6 19.5196 5.89464 19.7071 5.70711C19.8946 5.51957 20 5.26522 20 5V4H21C21.2652 4 21.5196 3.89464 21.7071 3.70711C21.8946 3.51957 22 3.26522 22 3C22 2.73478 21.8946 2.48043 21.7071 2.29289C21.5196 2.10536 21.2652 2 21 2Z" fill="white"/>
          </svg>
          <span v-if="is_streamer">Изменить</span>
          <span v-else>编辑封面图片</span>
        </p>
      </el-upload>
      <div v-show="level" class="user-profile-about__img--level"><p>{{level}}</p></div>
    </div>
    <div class="user-profile-about__name">
      <p>{{fio}}</p>
      <p>@{{nickname}}</p>
    </div>
    <div v-show="!is_streamer" class="user-profile-about__score">
      <img src="/diamond.svg" alt="">
      <div class="">
        <p>{{balance}}</p>
        <p>我的余额</p>
      </div>
    </div>
    <div v-show="!is_streamer" class="user-profile-about__questions">
      <p>补充 <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11.2898 15.29C11.2468 15.3375 11.2067 15.3876 11.1698 15.44C11.1319 15.4957 11.1016 15.5563 11.0798 15.62C11.0509 15.6767 11.0307 15.7374 11.0198 15.8C11.0149 15.8666 11.0149 15.9334 11.0198 16C11.0164 16.1312 11.0438 16.2613 11.0998 16.38C11.1447 16.5041 11.2163 16.6168 11.3096 16.7101C11.403 16.8034 11.5157 16.8751 11.6398 16.92C11.7595 16.9729 11.8889 17.0002 12.0198 17.0002C12.1506 17.0002 12.2801 16.9729 12.3998 16.92C12.5239 16.8751 12.6366 16.8034 12.7299 16.7101C12.8232 16.6168 12.8948 16.5041 12.9398 16.38C12.9842 16.2584 13.0045 16.1294 12.9998 16C13.0005 15.8684 12.9753 15.7379 12.9255 15.6161C12.8758 15.4943 12.8024 15.3834 12.7098 15.29C12.6168 15.1963 12.5062 15.1219 12.3843 15.0711C12.2625 15.0203 12.1318 14.9942 11.9998 14.9942C11.8677 14.9942 11.737 15.0203 11.6152 15.0711C11.4933 15.1219 11.3827 15.1963 11.2898 15.29ZM11.9998 2C10.0219 2 8.08855 2.58649 6.44406 3.6853C4.79957 4.78412 3.51784 6.3459 2.76096 8.17316C2.00409 10.0004 1.80606 12.0111 2.19191 13.9509C2.57776 15.8907 3.53017 17.6725 4.92869 19.0711C6.32722 20.4696 8.10905 21.422 10.0489 21.8079C11.9887 22.1937 13.9993 21.9957 15.8266 21.2388C17.6539 20.4819 19.2156 19.2002 20.3145 17.5557C21.4133 15.9112 21.9998 13.9778 21.9998 12C21.9998 10.6868 21.7411 9.38642 21.2386 8.17316C20.736 6.95991 19.9994 5.85752 19.0708 4.92893C18.1422 4.00035 17.0398 3.26375 15.8266 2.7612C14.6133 2.25866 13.313 2 11.9998 2ZM11.9998 20C10.4175 20 8.87079 19.5308 7.5552 18.6518C6.2396 17.7727 5.21422 16.5233 4.60872 15.0615C4.00322 13.5997 3.8448 11.9911 4.15348 10.4393C4.46216 8.88743 5.22409 7.46197 6.34291 6.34315C7.46173 5.22433 8.88719 4.4624 10.439 4.15372C11.9909 3.84504 13.5994 4.00346 15.0612 4.60896C16.523 5.21446 17.7725 6.23984 18.6515 7.55544C19.5306 8.87103 19.9998 10.4177 19.9998 12C19.9998 14.1217 19.1569 16.1566 17.6566 17.6569C16.1563 19.1571 14.1215 20 11.9998 20ZM11.9998 7C11.4728 6.99966 10.9551 7.13812 10.4987 7.40144C10.0422 7.66476 9.66323 8.04366 9.39976 8.5C9.3274 8.61382 9.27882 8.74109 9.25693 8.87418C9.23504 9.00726 9.2403 9.14339 9.27239 9.27439C9.30447 9.40538 9.36273 9.52853 9.44364 9.63643C9.52456 9.74433 9.62646 9.83475 9.74323 9.90224C9.85999 9.96974 9.98921 10.0129 10.1231 10.0292C10.257 10.0454 10.3928 10.0345 10.5223 9.99688C10.6518 9.9593 10.7724 9.89591 10.8768 9.81052C10.9812 9.72513 11.0672 9.6195 11.1298 9.5C11.2179 9.34739 11.3447 9.22078 11.4975 9.13298C11.6503 9.04517 11.8235 8.9993 11.9998 9C12.265 9 12.5193 9.10536 12.7069 9.29289C12.8944 9.48043 12.9998 9.73478 12.9998 10C12.9998 10.2652 12.8944 10.5196 12.7069 10.7071C12.5193 10.8946 12.265 11 11.9998 11C11.7345 11 11.4802 11.1054 11.2927 11.2929C11.1051 11.4804 10.9998 11.7348 10.9998 12V13C10.9998 13.2652 11.1051 13.5196 11.2927 13.7071C11.4802 13.8946 11.7345 14 11.9998 14C12.265 14 12.5193 13.8946 12.7069 13.7071C12.8944 13.5196 12.9998 13.2652 12.9998 13V12.82C13.6611 12.58 14.2171 12.1152 14.5705 11.5069C14.9239 10.8985 15.0523 10.1853 14.9332 9.49189C14.814 8.79849 14.455 8.16902 13.9188 7.71351C13.3825 7.25801 12.7033 7.00546 11.9998 7Z" fill="#CECFDF"/>
      </svg>
      </p>
      <p>如何使用 <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11.2898 15.29C11.2468 15.3375 11.2067 15.3876 11.1698 15.44C11.1319 15.4957 11.1016 15.5563 11.0798 15.62C11.0509 15.6767 11.0307 15.7374 11.0198 15.8C11.0149 15.8666 11.0149 15.9334 11.0198 16C11.0164 16.1312 11.0438 16.2613 11.0998 16.38C11.1447 16.5041 11.2163 16.6168 11.3096 16.7101C11.403 16.8034 11.5157 16.8751 11.6398 16.92C11.7595 16.9729 11.8889 17.0002 12.0198 17.0002C12.1506 17.0002 12.2801 16.9729 12.3998 16.92C12.5239 16.8751 12.6366 16.8034 12.7299 16.7101C12.8232 16.6168 12.8948 16.5041 12.9398 16.38C12.9842 16.2584 13.0045 16.1294 12.9998 16C13.0005 15.8684 12.9753 15.7379 12.9255 15.6161C12.8758 15.4943 12.8024 15.3834 12.7098 15.29C12.6168 15.1963 12.5062 15.1219 12.3843 15.0711C12.2625 15.0203 12.1318 14.9942 11.9998 14.9942C11.8677 14.9942 11.737 15.0203 11.6152 15.0711C11.4933 15.1219 11.3827 15.1963 11.2898 15.29ZM11.9998 2C10.0219 2 8.08855 2.58649 6.44406 3.6853C4.79957 4.78412 3.51784 6.3459 2.76096 8.17316C2.00409 10.0004 1.80606 12.0111 2.19191 13.9509C2.57776 15.8907 3.53017 17.6725 4.92869 19.0711C6.32722 20.4696 8.10905 21.422 10.0489 21.8079C11.9887 22.1937 13.9993 21.9957 15.8266 21.2388C17.6539 20.4819 19.2156 19.2002 20.3145 17.5557C21.4133 15.9112 21.9998 13.9778 21.9998 12C21.9998 10.6868 21.7411 9.38642 21.2386 8.17316C20.736 6.95991 19.9994 5.85752 19.0708 4.92893C18.1422 4.00035 17.0398 3.26375 15.8266 2.7612C14.6133 2.25866 13.313 2 11.9998 2ZM11.9998 20C10.4175 20 8.87079 19.5308 7.5552 18.6518C6.2396 17.7727 5.21422 16.5233 4.60872 15.0615C4.00322 13.5997 3.8448 11.9911 4.15348 10.4393C4.46216 8.88743 5.22409 7.46197 6.34291 6.34315C7.46173 5.22433 8.88719 4.4624 10.439 4.15372C11.9909 3.84504 13.5994 4.00346 15.0612 4.60896C16.523 5.21446 17.7725 6.23984 18.6515 7.55544C19.5306 8.87103 19.9998 10.4177 19.9998 12C19.9998 14.1217 19.1569 16.1566 17.6566 17.6569C16.1563 19.1571 14.1215 20 11.9998 20ZM11.9998 7C11.4728 6.99966 10.9551 7.13812 10.4987 7.40144C10.0422 7.66476 9.66323 8.04366 9.39976 8.5C9.3274 8.61382 9.27882 8.74109 9.25693 8.87418C9.23504 9.00726 9.2403 9.14339 9.27239 9.27439C9.30447 9.40538 9.36273 9.52853 9.44364 9.63643C9.52456 9.74433 9.62646 9.83475 9.74323 9.90224C9.85999 9.96974 9.98921 10.0129 10.1231 10.0292C10.257 10.0454 10.3928 10.0345 10.5223 9.99688C10.6518 9.9593 10.7724 9.89591 10.8768 9.81052C10.9812 9.72513 11.0672 9.6195 11.1298 9.5C11.2179 9.34739 11.3447 9.22078 11.4975 9.13298C11.6503 9.04517 11.8235 8.9993 11.9998 9C12.265 9 12.5193 9.10536 12.7069 9.29289C12.8944 9.48043 12.9998 9.73478 12.9998 10C12.9998 10.2652 12.8944 10.5196 12.7069 10.7071C12.5193 10.8946 12.265 11 11.9998 11C11.7345 11 11.4802 11.1054 11.2927 11.2929C11.1051 11.4804 10.9998 11.7348 10.9998 12V13C10.9998 13.2652 11.1051 13.5196 11.2927 13.7071C11.4802 13.8946 11.7345 14 11.9998 14C12.265 14 12.5193 13.8946 12.7069 13.7071C12.8944 13.5196 12.9998 13.2652 12.9998 13V12.82C13.6611 12.58 14.2171 12.1152 14.5705 11.5069C14.9239 10.8985 15.0523 10.1853 14.9332 9.49189C14.814 8.79849 14.455 8.16902 13.9188 7.71351C13.3825 7.25801 12.7033 7.00546 11.9998 7Z" fill="#CECFDF"/>
      </svg>
      </p>
    </div>
    <div v-show="is_streamer" class="user-profile-about__girl-stats">
      <div class="user-profile-about__girl-stats--item">
        <img src="/girl_rating_icon.png" alt="">
        <div class="user-profile-about__girl-stats--item--info">
          <p>{{girl_rating}}</p>
          <p>广播评级</p>
        </div>
      </div>
      <div class="user-profile-about__girl-stats--item">
        <img src="/girl_streams_icon.png" alt="">
        <div class="user-profile-about__girl-stats--item--info">
          <p>{{stream_rating}}</p>
          <p>广播评级</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
  export default {
    props:['avatar','level','fio','nickname','balance','is_streamer','girl_rating','stream_rating','is_own_profile'],
    data() {
      return {
        userData:{
          avatar:this.$auth.user.avatar,
          password1:null,
          password2:null
        },
        avatarImage:null,
      };
    },
    watch: {
    },
    mounted() {
    },
    methods: {
      notify(title,message,type){
        this.$notify({
          title: title,
          message: message,
          type: type
        });
      },
      async updateUser(){
        let formData = new FormData()
        formData.set('userData', JSON.stringify(this.userData))

        formData.set('avatar',this.avatarImage)

        await this.$axios({
          method: 'post',
          headers:{
            'content-type': 'multipart/form-data'
          },
          url: '/api/v1/user/update/',
          data: formData
        }).then((response) => {
          this.notify('Успешно','Данные обновлены','success')
          this.$auth.fetchUser()
        })
          .catch(function (error) {
            // handle error
          })
          .then(function () {
            // always executed
          });
      },
      handleAvatarSuccess(res, file) {
        this.userData.avatar = URL.createObjectURL(file.raw);
        this.avatarImage = file.raw
        this.updateUser()
      },
    }
  }
</script>


